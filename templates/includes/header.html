{% load static %}
<header
  class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-md shadow-sm sticky top-0 z-50 border-b border-gray-200 dark:border-gray-700"
  x-data="{ mobileMenuOpen: false, searchOpen: false, notificationsOpen: false }"
>
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-3">
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <a
        href="{% url 'home' %}"
        class="flex items-center space-x-2 space-x-reverse group"
      >
        <div
          class="w-10 h-10 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-lg flex items-center justify-center transform group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 shadow-lg"
        >
          <i class="fas fa-graduation-cap text-white text-xl"></i>
        </div>
        <span
          class="text-xl font-bold bg-gradient-to-l from-purple-600 to-indigo-600 bg-clip-text text-transparent hidden sm:block"
        >
          منصة الكورسات
        </span>
      </a>

      <!-- Desktop Navigation (Middle) -->
      <div class="hidden lg:flex items-center space-x-1 space-x-reverse">
        <a
          href="{% url 'home' %}"
          class="nav-link {% if request.path == '/' %}active{% endif %}"
        >
          <i class="fas fa-home ml-1"></i>
          الرئيسية
        </a>

        <!-- Categories Dropdown -->
        <div class="relative" x-data="{ categoriesOpen: false }">
          <button
            @click="categoriesOpen = !categoriesOpen"
            class="nav-link flex items-center"
          >
            <i class="fas fa-book ml-1"></i>
            التصنيفات
            <i
              class="fas fa-chevron-down mr-1 text-xs transition-transform"
              :class="{'rotate-180': categoriesOpen}"
            ></i>
          </button>

          <div
            x-show="categoriesOpen"
            @click.away="categoriesOpen = false"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 translate-y-1"
            x-transition:enter-end="opacity-100 translate-y-0"
            class="absolute top-full right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-2xl py-2 z-50 border border-gray-200 dark:border-gray-700"
          >
            <h3
              class="px-4 py-2 text-sm font-semibold text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700"
            >
              جميع التصنيفات
            </h3>

            {% for category in categories|slice:":8" %}
            <a
              href="{% url 'home' %}?category={{ category.slug }}"
              class="flex items-center justify-between px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group"
            >
              <span class="flex items-center">
                <i class="fas fa-folder ml-2 text-purple-500 text-sm"></i>
                {{ category.name }}
              </span>
              <span
                class="text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full group-hover:bg-purple-500 group-hover:text-white transition-colors"
              >
                {{ category.course_count }}
              </span>
            </a>
            {% endfor %}

            <div
              class="border-t border-gray-200 dark:border-gray-700 mt-2 pt-2"
            >
              <a
                href="{% url 'home' %}"
                class="block px-4 py-2 text-purple-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm"
              >
                عرض الكل
                <i class="fas fa-arrow-left mr-1"></i>
              </a>
            </div>
          </div>
        </div>

        <a href="{% url 'home' %}?featured=true" class="nav-link">
          <i class="fas fa-star ml-1 text-yellow-500"></i>
          مميزة
        </a>

        <a href="{% url 'home' %}?new=true" class="nav-link">
          <i class="fas fa-clock ml-1 text-green-500"></i>
          أحدث الكورسات
        </a>

        <a href="#diplomas" class="nav-link">
          <i class="fas fa-layer-group ml-1 text-purple-500"></i>
          الدبلومات
        </a>
      </div>

      <!-- Right Side Actions -->
      <div class="hidden lg:flex items-center space-x-3 space-x-reverse">
        <!-- Search Button -->
        <button
          @click="searchOpen = !searchOpen"
          class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors relative"
        >
          <i class="fas fa-search text-xl"></i>
          <span
            class="absolute -top-1 -right-1 w-2 h-2 bg-purple-500 rounded-full"
            x-show="searchOpen"
          ></span>
        </button>

        <!-- Notifications -->
        {% if user.is_authenticated %}
        <div class="relative" x-data="{ notificationsOpen: false }">
          <button
            @click="notificationsOpen = !notificationsOpen"
            class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors relative"
          >
            <i class="fas fa-bell text-xl"></i>
            <span
              class="absolute top-0 right-0 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center"
              >3</span
            >
          </button>

          <!-- Notifications Dropdown -->
          <div
            x-show="notificationsOpen"
            @click.away="notificationsOpen = false"
            x-transition
            class="absolute left-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-2xl py-2 z-50 border border-gray-200 dark:border-gray-700"
          >
            <div
              class="px-4 py-2 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"
            >
              <h3 class="font-semibold">الإشعارات</h3>
              <a href="#" class="text-xs text-purple-600 hover:text-purple-700"
                >تحديد الكل كمقروء</a
              >
            </div>

            <div class="max-h-96 overflow-y-auto">
              <!-- Notification Item -->
              <a
                href="#"
                class="flex items-start px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors border-b border-gray-100 dark:border-gray-700"
              >
                <div
                  class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center ml-3 flex-shrink-0"
                >
                  <i
                    class="fas fa-check-circle text-green-600 dark:text-green-400"
                  ></i>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-semibold">تم قبول تسجيلك</p>
                  <p class="text-xs text-gray-500">تم تسجيلك في كورس بايثون</p>
                  <span class="text-xs text-gray-400">منذ 5 دقائق</span>
                </div>
              </a>

              <a
                href="#"
                class="flex items-start px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
              >
                <div
                  class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center ml-3 flex-shrink-0"
                >
                  <i class="fas fa-gift text-blue-600 dark:text-blue-400"></i>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-semibold">عرض خاص</p>
                  <p class="text-xs text-gray-500">خصم 20% على جميع الكورسات</p>
                  <span class="text-xs text-gray-400">منذ ساعة</span>
                </div>
              </a>
            </div>

            <div
              class="border-t border-gray-200 dark:border-gray-700 mt-2 pt-2 px-4"
            >
              <a
                href="#"
                class="text-sm text-purple-600 hover:text-purple-700 block text-center"
              >
                عرض كل الإشعارات
              </a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Theme Toggle -->
        <button
          @click="toggleTheme()"
          class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
          title="تغيير المظهر"
        >
          <i class="fas fa-moon dark:hidden text-xl"></i>
          <i class="fas fa-sun hidden dark:inline text-xl"></i>
        </button>

        <!-- User Menu -->
        {% if user.is_authenticated %}
        <div class="relative" x-data="{ userMenuOpen: false }">
          <button
            @click="userMenuOpen = !userMenuOpen"
            class="flex items-center space-x-2 space-x-reverse p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors group"
          >
            <div
              class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform"
            >
              <span class="text-white font-bold text-lg">
                {{ user.username|first|upper }}
              </span>
            </div>
            <div class="hidden xl:block text-right">
              <div class="text-sm font-semibold">
                {{ user.get_full_name|default:user.username }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">
                {% if user.is_admin_user %}أدمن{% else %}مستخدم{% endif %}
              </div>
            </div>
            <i
              class="fas fa-chevron-down text-xs transition-transform"
              :class="{'rotate-180': userMenuOpen}"
            ></i>
          </button>

          <!-- User Dropdown -->
          <div
            x-show="userMenuOpen"
            @click.away="userMenuOpen = false"
            x-transition
            class="absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-2xl py-2 z-50 border border-gray-200 dark:border-gray-700"
          >
            <!-- User Info -->
            <div
              class="px-4 py-3 border-b border-gray-200 dark:border-gray-700"
            >
              <p class="font-semibold">
                {{ user.get_full_name|default:user.username }}
              </p>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                {{ user.email }}
              </p>
            </div>

            <!-- Menu Items -->
            <a
              href="{% url 'user_dashboard' %}"
              class="flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <i class="fas fa-tachometer-alt ml-3 text-purple-500 w-5"></i>
              <span>لوحة التحكم</span>
            </a>

            <a
              href="{% url 'user_dashboard' %}#favorites"
              class="flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <i class="fas fa-heart ml-3 text-red-500 w-5"></i>
              <span>المفضلة</span>
              {% with favorites_count=user.favorites.count %} {% if
              favorites_count %}
              <span
                class="mr-auto bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full"
                >{{ favorites_count }}</span
              >
              {% endif %} {% endwith %}
            </a>

            <a
              href="{% url 'user_dashboard' %}#enrolled"
              class="flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <i class="fas fa-book-open ml-3 text-green-500 w-5"></i>
              <span>كورساتي</span>
              {% with enrolled_count=user.enrollments.count %} {% if
              enrolled_count %}
              <span
                class="mr-auto bg-green-100 text-green-600 text-xs px-2 py-1 rounded-full"
                >{{ enrolled_count }}</span
              >
              {% endif %} {% endwith %}
            </a>

            <a
              href="#"
              class="flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <i class="fas fa-user-cog ml-3 text-blue-500 w-5"></i>
              <span>الملف الشخصي</span>
            </a>

            {% if user.is_admin_user %}
            <div
              class="border-t border-gray-200 dark:border-gray-700 my-2"
            ></div>

            <a
              href="{% url 'admin_dashboard' %}"
              class="flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <i class="fas fa-crown ml-3 text-yellow-500 w-5"></i>
              <span>لوحة الأدمن</span>
            </a>

            <a
              href="{% url 'admin:index' %}"
              class="flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <i class="fas fa-database ml-3 text-blue-500 w-5"></i>
              <span>Django Admin</span>
            </a>
            {% endif %}

            <div
              class="border-t border-gray-200 dark:border-gray-700 my-2"
            ></div>

            <form method="post" action="{% url 'admin:logout' %}">
              {% csrf_token %}
              <button
                type="submit"
                class="w-full text-right flex items-center px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors"
              >
                <i class="fas fa-sign-out-alt ml-3 w-5"></i>
                <span>تسجيل الخروج</span>
              </button>
            </form>
          </div>
        </div>

        {% else %}
        <div class="flex items-center space-x-2 space-x-reverse">
          <a
            href="{% url 'admin:login' %}"
            class="border-2 border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white px-4 py-2 rounded-lg transition text-sm font-bold"
          >
            <i class="fas fa-user ml-1"></i>
            دخول
          </a>
          <a
            href="{% url 'admin:login' %}"
            class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition text-sm font-bold"
          >
            <i class="fas fa-user-plus ml-1"></i>
            حساب جديد
          </a>
        </div>
        {% endif %}
      </div>

      <!-- Mobile Menu Button -->
      <div class="flex items-center space-x-2 space-x-reverse lg:hidden">
        <button
          @click="searchOpen = !searchOpen"
          class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"
        >
          <i class="fas fa-search text-xl"></i>
        </button>

        <button
          @click="toggleTheme()"
          class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"
        >
          <i class="fas fa-moon dark:hidden text-xl"></i>
          <i class="fas fa-sun hidden dark:inline text-xl"></i>
        </button>

        <button
          @click="mobileMenuOpen = !mobileMenuOpen"
          class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"
        >
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>

    <!-- Search Bar (Expandable) -->
    <div x-show="searchOpen" x-cloak x-transition class="mt-4">
      <form
        method="GET"
        action="{% url 'home' %}"
        class="relative"
        x-data="{ searchQuery: '{{ search_query }}' }"
      >
        <input
          type="text"
          name="search"
          x-model="searchQuery"
          placeholder="ابحث عن كورس، مدرب، تصنيف..."
          class="w-full pl-12 pr-4 py-4 bg-gray-100 dark:bg-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all"
          autofocus
        />
        <button
          type="submit"
          class="absolute left-4 top-4 text-gray-400 hover:text-purple-500 transition-colors"
        >
          <i class="fas fa-search text-xl"></i>
        </button>

        <!-- Quick Search Suggestions -->
        <div
          x-show="searchQuery.length > 2"
          class="absolute top-full left-0 right-0 mt-2 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50"
        >
          <div class="p-2">
            <div class="text-xs text-gray-500 px-3 py-2">اقتراحات البحث:</div>
            <a
              href="#"
              class="flex items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
            >
              <i class="fas fa-search ml-2 text-gray-400"></i>
              <span>كورسات بايثون</span>
            </a>
            <a
              href="#"
              class="flex items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
            >
              <i class="fas fa-search ml-2 text-gray-400"></i>
              <span>تصميم جرافيك</span>
            </a>
            <a
              href="#"
              class="flex items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
            >
              <i class="fas fa-search ml-2 text-gray-400"></i>
              <span>موشن جرافيك</span>
            </a>
          </div>
        </div>
      </form>
    </div>

    <!-- Mobile Menu -->
    <div
      x-show="mobileMenuOpen"
      x-cloak
      x-transition
      class="lg:hidden mt-4 space-y-2 pb-4"
    >
      <!-- Mobile Navigation Links -->
      <a
        href="{% url 'home' %}"
        class="flex items-center px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
      >
        <i class="fas fa-home ml-3 text-purple-500 w-5"></i>
        <span>الرئيسية</span>
      </a>

      <a
        href="{% url 'home' %}?featured=true"
        class="flex items-center px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
      >
        <i class="fas fa-star ml-3 text-yellow-500 w-5"></i>
        <span>مميزة</span>
      </a>

      <a
        href="{% url 'home' %}?new=true"
        class="flex items-center px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
      >
        <i class="fas fa-clock ml-3 text-green-500 w-5"></i>
        <span>أحدث الكورسات</span>
      </a>

      <a
        href="#diplomas"
        class="flex items-center px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
      >
        <i class="fas fa-layer-group ml-3 text-indigo-500 w-5"></i>
        <span>الدبلومات</span>
      </a>

      <div class="border-t border-gray-200 dark:border-gray-700 my-2"></div>

      <h3 class="px-4 py-2 text-sm font-semibold text-gray-500">التصنيفات</h3>

      {% for category in categories|slice:":5" %}
      <a
        href="{% url 'home' %}?category={{ category.slug }}"
        class="flex items-center justify-between px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
      >
        <span class="flex items-center">
          <i class="fas fa-folder ml-2 text-purple-500"></i>
          {{ category.name }}
        </span>
        <span
          class="text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full"
          >{{ category.course_count }}</span
        >
      </a>
      {% endfor %}

      <a
        href="{% url 'home' %}"
        class="block px-4 py-2 text-purple-600 text-sm"
      >
        عرض الكل
        <i class="fas fa-arrow-left mr-1"></i>
      </a>

      {% if not user.is_authenticated %}
      <div class="border-t border-gray-200 dark:border-gray-700 my-2"></div>
      <div class="grid grid-cols-2 gap-2 pt-2">
        <a
          href="{% url 'admin:login' %}"
          class="border-2 border-purple-600 text-purple-600 text-center py-2 rounded-lg hover:bg-purple-600 hover:text-white transition text-sm font-bold"
        >
          <i class="fas fa-sign-in-alt ml-1"></i>
          دخول
        </a>
        <a
          href="{% url 'admin:login' %}"
          class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white text-center py-2 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition text-sm font-bold"
        >
          <i class="fas fa-user-plus ml-1"></i>
          حساب جديد
        </a>
      </div>
      {% endif %}
    </div>
  </nav>
</header>
