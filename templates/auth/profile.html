{% extends 'base.html' %}
{% load static %}

{% block title %}Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - {{ block.super }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="mb-8 bg-gradient-to-r from-primary-600 to-primary-800 dark:from-primary-800 dark:to-primary-950 rounded-2xl p-8 text-white relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-white opacity-5 rounded-full translate-y-1/2 -translate-x-1/2"></div>
        
        <div class="relative z-10">
            <h1 class="text-3xl font-bold mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ user.first_name|default:user.username }}! ğŸ‘‹</h1>
            <p class="text-white/90">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ Ø¥Ù„Ù‰ Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Sidebar - Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
        <div class="lg:col-span-1">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sticky top-24 transform transition-all duration-300 hover:shadow-xl">
                <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ ØªØ£Ø«ÙŠØ±Ø§Øª -->
                <div class="text-center mb-6 relative group">
                    <div class="relative inline-block">
                        {% if user.avatar %}
                        <img src="{{ user.avatar.url }}" alt="{{ user.get_full_name }}" 
                             class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-4 border-primary-500 group-hover:scale-105 transition duration-300 group-hover:shadow-2xl">
                        {% else %}
                        <div class="w-32 h-32 rounded-full mx-auto mb-4 bg-gradient-to-br from-primary-500 to-primary-700 flex items-center justify-center border-4 border-white dark:border-gray-800 group-hover:scale-105 transition duration-300 shadow-lg">
                            <span class="text-4xl text-white font-bold">{{ user.first_name|first|upper }}{{ user.last_name|first|upper }}</span>
                        </div>
                        {% endif %}
                        
                        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø© (Ù…ØªØµÙ„/ØºÙŠØ± Ù…ØªØµÙ„) -->
                        <span class="absolute bottom-2 right-2 w-4 h-4 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"></span>
                        
                        <!-- Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© (ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ…) -->
                        <label for="avatar-upload" class="absolute inset-0 bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition duration-300">
                            <i class="fas fa-camera text-white text-2xl"></i>
                        </label>
                        <input type="file" id="avatar-upload" class="hidden" accept="image/*">
                    </div>
                    
                    <h2 class="text-2xl font-bold">{{ user.get_full_name|default:user.username }}</h2>
                    <p class="text-gray-600 dark:text-gray-400 flex items-center justify-center gap-1">
                        <i class="fas fa-envelope text-sm"></i>
                        {{ user.email }}
                    </p>
                    
                    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ù…Ø¹ ØªØ£Ø«ÙŠØ±Ø§Øª -->
                    <div class="mt-4 flex flex-wrap gap-2 justify-center">
                        {% if user.is_superuser %}
                        <span class="px-4 py-1.5 bg-gradient-to-r from-purple-600 to-purple-800 text-white text-sm rounded-full font-semibold shadow-lg flex items-center gap-1 animate-pulse-slow">
                            <i class="fas fa-crown"></i>
                            Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†
                        </span>
                        {% endif %}
                        
                        <span class="px-4 py-1.5 text-white text-sm rounded-full font-semibold shadow-lg flex items-center gap-1
                            {% if user.role == 'admin' %}bg-gradient-to-r from-purple-500 to-purple-700
                            {% elif user.role == 'instructor' %}bg-gradient-to-r from-green-500 to-green-700
                            {% else %}bg-gradient-to-r from-blue-500 to-blue-700{% endif %}">
                            <i class="fas 
                                {% if user.role == 'admin' %}fa-crown
                                {% elif user.role == 'instructor' %}fa-chalkboard-teacher
                                {% else %}fa-user-graduate{% endif %}">
                            </i>
                            {% if user.role == 'admin' %}Ù…Ø¯ÙŠØ±
                            {% elif user.role == 'instructor' %}Ù…Ø¯Ø±Ø¨
                            {% else %}Ø·Ø§Ù„Ø¨{% endif %}
                        </span>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
                <div class="grid grid-cols-3 gap-2 mb-6">
                    <div class="bg-primary-50 dark:bg-primary-900/20 rounded-lg p-3 text-center group hover:bg-primary-100 dark:hover:bg-primary-900/40 transition">
                        <div class="text-2xl font-bold text-primary-600 group-hover:scale-110 transition">{{ stats.enrolled_courses|default:'0' }}</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">Ø¯ÙˆØ±Ø©</div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3 text-center group hover:bg-green-100 dark:hover:bg-green-900/40 transition">
                        <div class="text-2xl font-bold text-green-600 group-hover:scale-110 transition">{{ stats.completed_courses|default:'0' }}</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">Ù…ÙƒØªÙ…Ù„Ø©</div>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-3 text-center group hover:bg-yellow-100 dark:hover:bg-yellow-900/40 transition">
                        <div class="text-2xl font-bold text-yellow-600 group-hover:scale-110 transition">{{ favorites_count|default:'0' }}</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">Ù…ÙØ¶Ù„Ø©</div>
                    </div>
                </div>

                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ -->
                <nav class="space-y-1">
                    <a href="#profile" onclick="showTab('profile')" 
                       class="flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-300 tab-link group"
                       data-tab="profile">
                        <div class="w-8 h-8 bg-primary-100 dark:bg-primary-900 rounded-lg flex items-center justify-center ml-3 group-hover:scale-110 transition">
                            <i class="fas fa-user text-primary-600 dark:text-primary-400"></i>
                        </div>
                        <span class="flex-1">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</span>
                        <i class="fas fa-chevron-left text-gray-400 text-sm opacity-0 group-hover:opacity-100 transition"></i>
                    </a>
                    
                    <a href="#stats" onclick="showTab('stats')" 
                       class="flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-300 tab-link group"
                       data-tab="stats">
                        <div class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center ml-3 group-hover:scale-110 transition">
                            <i class="fas fa-chart-bar text-green-600 dark:text-green-400"></i>
                        </div>
                        <span class="flex-1">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
                        <i class="fas fa-chevron-left text-gray-400 text-sm opacity-0 group-hover:opacity-100 transition"></i>
                    </a>
                    
                    <a href="#favorites" onclick="showTab('favorites')" 
                       class="flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-300 tab-link group"
                       data-tab="favorites">
                        <div class="w-8 h-8 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center ml-3 group-hover:scale-110 transition">
                            <i class="fas fa-heart text-red-600 dark:text-red-400"></i>
                        </div>
                        <span class="flex-1">Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>
                        {% if favorites_count %}
                        <span class="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse">{{ favorites_count }}</span>
                        {% endif %}
                    </a>
                    
                    <a href="#activities" onclick="showTab('activities')" 
                       class="flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-300 tab-link group"
                       data-tab="activities">
                        <div class="w-8 h-8 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center ml-3 group-hover:scale-110 transition">
                            <i class="fas fa-history text-yellow-600 dark:text-yellow-400"></i>
                        </div>
                        <span class="flex-1">Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©</span>
                        <i class="fas fa-chevron-left text-gray-400 text-sm opacity-0 group-hover:opacity-100 transition"></i>
                    </a>
                    
                    <!-- Ø±ÙˆØ§Ø¨Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ† -->
                    {% if user.is_superuser or user.role == 'admin' %}
                    <div class="border-t border-gray-200 dark:border-gray-700 my-2 pt-2"></div>
                    
                    <a href="{% url 'courses:admin_dashboard' %}" 
                       class="flex items-center px-4 py-3 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-xl transition-all duration-300 group">
                        <div class="w-8 h-8 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center ml-3 group-hover:scale-110 transition">
                            <i class="fas fa-crown text-purple-600 dark:text-purple-400"></i>
                        </div>
                        <span class="flex-1">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</span>
                        <i class="fas fa-external-link-alt text-sm opacity-0 group-hover:opacity-100 transition"></i>
                    </a>
                    {% endif %}
                    
                    {% if user.is_instructor %}
                    <a href="{% url 'courses:instructor_dashboard' %}" 
                       class="flex items-center px-4 py-3 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-xl transition-all duration-300 group">
                        <div class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center ml-3 group-hover:scale-110 transition">
                            <i class="fas fa-chalkboard-teacher text-green-600 dark:text-green-400"></i>
                        </div>
                        <span class="flex-1">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</span>
                        <i class="fas fa-external-link-alt text-sm opacity-0 group-hover:opacity-100 transition"></i>
                    </a>
                    {% endif %}
                </nav>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="lg:col-span-3">
            <!-- ==================== ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ==================== -->
            <div id="profile-tab" class="tab-content">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-user-edit text-primary-600"></i>
                            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                        </h2>
                        <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400 text-sm rounded-full">
                            <i class="fas fa-check-circle ml-1"></i>
                            Ù…ØªØµÙ„
                        </span>
                    </div>
                    
                    <form method="post" enctype="multipart/form-data" class="space-y-6">
                        {% csrf_token %}
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {% for field in form %}
                            <div class="{% if field.name == 'bio' %}md:col-span-2{% endif %}">
                                <label for="{{ field.id_for_label }}" class="block text-sm font-medium mb-2">
                                    {{ field.label }}
                                    {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
                                </label>
                                
                                {% if field.name == 'bio' %}
                                <textarea name="{{ field.name }}" id="{{ field.id_for_label }}" 
                                          rows="4" 
                                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition"
                                          placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ...">{{ field.value|default:'' }}</textarea>
                                {% elif field.name == 'avatar' %}
                                <div class="flex items-center gap-4">
                                    {{ field }}
                                    <button type="button" onclick="document.getElementById('{{ field.id_for_label }}').click()" 
                                            class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                                        <i class="fas fa-upload ml-2"></i>
                                        Ø§Ø®ØªØ± ØµÙˆØ±Ø©
                                    </button>
                                </div>
                                {% else %}
                                <input type="{% if field.name == 'email' %}email{% else %}text{% endif %}" 
                                       name="{{ field.name }}" 
                                       id="{{ field.id_for_label }}"
                                       value="{{ field.value|default:'' }}"
                                       class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition"
                                       {% if field.field.required %}required{% endif %}>
                                {% endif %}
                                
                                {% if field.errors %}
                                <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
                                    <i class="fas fa-exclamation-circle"></i>
                                    {{ field.errors.0 }}
                                </p>
                                {% endif %}
                                
                                {% if field.help_text %}
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{{ field.help_text }}</p>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        
                        <div class="flex gap-4 pt-6 border-t border-gray-200 dark:border-gray-700">
                            <button type="submit" class="px-6 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition transform hover:scale-105 flex items-center gap-2 shadow-lg">
                                <i class="fas fa-save"></i>
                                Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                            </button>
                            <button type="reset" class="px-6 py-3 bg-gray-600 text-white rounded-xl hover:bg-gray-700 transition flex items-center gap-2">
                                <i class="fas fa-undo"></i>
                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ==================== ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ==================== -->
            <div id="stats-tab" class="tab-content hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        <i class="fas fa-chart-pie text-primary-600"></i>
                        Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„Ù…
                    </h2>
                    
                    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg transform hover:scale-105 transition">
                            <div class="flex items-center justify-between mb-4">
                                <i class="fas fa-book-open text-3xl opacity-80"></i>
                                <span class="text-4xl font-bold">{{ stats.enrolled_courses|default:'0' }}</span>
                            </div>
                            <h3 class="text-lg font-semibold">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„ ÙÙŠÙ‡Ø§</h3>
                            <p class="text-blue-100 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg transform hover:scale-105 transition">
                            <div class="flex items-center justify-between mb-4">
                                <i class="fas fa-check-circle text-3xl opacity-80"></i>
                                <span class="text-4xl font-bold">{{ stats.completed_courses|default:'0' }}</span>
                            </div>
                            <h3 class="text-lg font-semibold">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>
                            <p class="text-green-100 text-sm">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„: {% widthratio stats.completed_courses|default:0 stats.enrolled_courses|default:1 100 %}%</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-6 text-white shadow-lg transform hover:scale-105 transition">
                            <div class="flex items-center justify-between mb-4">
                                <i class="fas fa-heart text-3xl opacity-80"></i>
                                <span class="text-4xl font-bold">{{ favorites_count|default:'0' }}</span>
                            </div>
                            <h3 class="text-lg font-semibold">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©</h3>
                            <p class="text-yellow-100 text-sm">ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù„Ù…ÙØ¶Ù„Ø©</p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-lg transform hover:scale-105 transition">
                            <div class="flex items-center justify-between mb-4">
                                <i class="fas fa-star text-3xl opacity-80"></i>
                                <span class="text-4xl font-bold">{{ stats.reviews_written|default:'0' }}</span>
                            </div>
                            <h3 class="text-lg font-semibold">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3>
                            <p class="text-purple-100 text-sm">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙƒØªÙˆØ¨Ø©</p>
                        </div>
                    </div>

                    <!-- ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ¹Ù„Ù… -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-chart-line text-primary-600"></i>
                            ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ¹Ù„Ù…
                        </h3>
                        
                        {% for enrollment in active_enrollments|slice:":5" %}
                        <div class="mb-4 last:mb-0">
                            <div class="flex justify-between items-center mb-1">
                                <div class="flex items-center gap-2">
                                    <img src="{{ enrollment.course.image.url|default:'https://via.placeholder.com/30' }}" 
                                         alt="{{ enrollment.course.title }}" 
                                         class="w-8 h-8 rounded object-cover">
                                    <span class="font-medium text-sm">{{ enrollment.course.title|truncatechars:30 }}</span>
                                </div>
                                <span class="text-sm font-bold text-primary-600">{{ enrollment.progress }}%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                <div class="bg-primary-600 rounded-full h-2 transition-all duration-500 progress-bar" 
                                     style="width: {{ enrollment.progress }}%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">
                                <i class="far fa-clock ml-1"></i>
                                Ø¢Ø®Ø± Ù†Ø´Ø§Ø·: {{ enrollment.last_accessed|timesince }}
                            </p>
                        </div>
                        {% empty %}
                        <p class="text-center text-gray-500 dark:text-gray-400 py-8">
                            <i class="fas fa-info-circle ml-2"></i>
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…
                        </p>
                        {% endfor %}
                    </div>

                    <!-- Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-star text-yellow-500"></i>
                            Ø¢Ø®Ø± ØªÙ‚ÙŠÙŠÙ…Ø§ØªÙƒ
                        </h3>
                        
                        {% for review in recent_reviews|slice:":3" %}
                        <div class="border-b border-gray-200 dark:border-gray-700 last:border-0 pb-4 last:pb-0 mb-4 last:mb-0">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-semibold">{{ review.course.title }}</h4>
                                    <div class="flex items-center gap-1 mt-1">
                                        {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= review.rating %}
                                        <i class="fas fa-star text-yellow-400 text-sm"></i>
                                        {% else %}
                                        <i class="far fa-star text-yellow-400 text-sm"></i>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">{{ review.created_at|date:'Y-m-d' }}</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">{{ review.comment|truncatechars:100 }}</p>
                        </div>
                        {% empty %}
                        <p class="text-center text-gray-500 dark:text-gray-400 py-4">
                            <i class="fas fa-star ml-2"></i>
                            Ù„Ù… ØªÙƒØªØ¨ Ø£ÙŠ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯
                        </p>
                        {% endfor %}
                    </div>
                </div>
            </div>

  

            <!-- ==================== ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ÙØ¶Ù„Ø© ==================== -->
            <div id="favorites-tab" class="tab-content hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-heart text-red-500"></i>
                            Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©
                        </h2>
                        {% if favorites_count %}
                        <span class="px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-xl text-sm font-semibold flex items-center gap-2">
                            <i class="fas fa-heart"></i>
                            {{ favorites_count }} Ø¯ÙˆØ±Ø©
                        </span>
                        {% endif %}
                    </div>
                    
                    {% if favorites %}
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {% for favorite in favorites %}
                        <div class="group relative bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-2xl shadow-md hover:shadow-2xl transition-all duration-500 overflow-hidden border border-gray-100 dark:border-gray-700 transform hover:-translate-y-2">
                            <!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ Ù…Ù„ÙˆÙ† -->
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 to-pink-500"></div>
                            
                            <div class="p-5">
                                <div class="flex gap-4">
                                    <!-- ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙˆØ±Ø© -->
                                    <div class="relative w-24 h-24 flex-shrink-0">
                                        {% if favorite.course.image %}
                                        <img src="{{ favorite.course.image.url }}" 
                                            alt="{{ favorite.course.title }}" 
                                            class="w-full h-full object-cover rounded-xl shadow-md group-hover:scale-105 transition duration-500">
                                        {% else %}
                                        <div class="w-full h-full bg-gradient-to-br from-primary-500 to-primary-700 rounded-xl flex items-center justify-center shadow-md">
                                            <i class="fas fa-image text-white text-2xl"></i>
                                        </div>
                                        {% endif %}
                                        
                                        <!-- Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø¹Ø± -->
                                        {% if favorite.course.price == 0 %}
                                        <span class="absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full shadow-lg animate-pulse">
                                            <i class="fas fa-gift ml-1"></i>
                                            Ù…Ø¬Ø§Ù†ÙŠ
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙˆØ±Ø© -->
                                    <div class="flex-1">
                                        <div class="flex items-start justify-between">
                                            <div>
                                                <h3 class="font-bold text-lg line-clamp-1 group-hover:text-primary-600 transition">
                                                    <a href="{% url 'courses:course_detail' favorite.course.slug %}" class="hover:underline">
                                                        {{ favorite.course.title }}
                                                    </a>
                                                </h3>
                                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                    <i class="fas fa-folder ml-1"></i>
                                                    {{ favorite.course.category.name }}
                                                </p>
                                            </div>
                                            
                                            <!-- Ø²Ø± Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø© -->
                                            <button onclick="removeFromFavorites({{ favorite.course.id }})" 
                                                    class="text-red-500 hover:text-red-700 transition transform hover:scale-125 bg-red-50 dark:bg-red-900/20 w-8 h-8 rounded-full flex items-center justify-center"
                                                    title="Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø¨ -->
                                        <div class="flex items-center gap-2 mt-3">
                                            {% if favorite.course.instructor.avatar %}
                                            <img src="{{ favorite.course.instructor.avatar.url }}" 
                                                alt="{{ favorite.course.instructor.get_full_name }}" 
                                                class="w-6 h-6 rounded-full object-cover">
                                            {% else %}
                                            <div class="w-6 h-6 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                                                <span class="text-primary-600 dark:text-primary-400 text-xs font-bold">
                                                    {{ favorite.course.instructor.first_name|first|upper }}
                                                </span>
                                            </div>
                                            {% endif %}
                                            <span class="text-xs text-gray-600 dark:text-gray-400">
                                                {{ favorite.course.instructor.get_full_name|default:favorite.course.instructor.username }}
                                            </span>
                                        </div>
                                        
                                        <!-- Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø³Ø¹Ø± -->
                                        <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
                                            <div class="flex items-center gap-2">
                                                <div class="flex items-center">
                                                    {% for i in "12345"|make_list %}
                                                    {% if forloop.counter <= favorite.course.rating %}
                                                    <i class="fas fa-star text-yellow-400 text-xs"></i>
                                                    {% elif forloop.counter <= favorite.course.rating|add:"0.5" %}
                                                    <i class="fas fa-star-half-alt text-yellow-400 text-xs"></i>
                                                    {% else %}
                                                    <i class="far fa-star text-yellow-400 text-xs"></i>
                                                    {% endif %}
                                                    {% endfor %}
                                                </div>
                                                <span class="text-xs text-gray-500 dark:text-gray-500">
                                                    ({{ favorite.course.reviews.count }})
                                                </span>
                                            </div>
                                            
                                            <div class="flex items-center gap-3">
                                                <span class="text-sm font-bold {% if favorite.course.price == 0 %}text-green-600{% else %}text-primary-600{% endif %}">
                                                    {% if favorite.course.price == 0 %}
                                                    Ù…Ø¬Ø§Ù†Ø§Ù‹
                                                    {% else %}
                                                    ${{ favorite.course.price }}
                                                    {% endif %}
                                                </span>
                                                
                                                <a href="{% url 'courses:course_detail' favorite.course.slug %}" 
                                                class="text-primary-600 hover:text-primary-700 text-sm font-semibold flex items-center gap-1 bg-primary-50 dark:bg-primary-900/30 px-3 py-1 rounded-full transition hover:bg-primary-100 dark:hover:bg-primary-900/50">
                                                    Ø¹Ø±Ø¶
                                                    <i class="fas fa-arrow-left text-xs"></i>
                                                </a>
                                            </div>
                                        </div>
                                        
                                        <!-- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
                                        <div class="mt-2 text-xs text-gray-400 dark:text-gray-500 flex items-center gap-1">
                                            <i class="far fa-clock"></i>
                                            Ø£Ø¶ÙŠÙØª: {{ favorite.created_at|date:'Y/m/d' }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙƒØ¨ÙŠØ±ØŒ Ù†Ø¶ÙŠÙ Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ -->
                    {% if favorites_count > 6 %}
                    <div class="text-center mt-8">
                        <button class="px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition font-semibold">
                            <i class="fas fa-sync-alt ml-2"></i>
                            ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯
                        </button>
                    </div>
                    {% endif %}
                    
                    {% else %}
                    <!-- Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…ÙØ¶Ù„Ø© -->
                    <div class="text-center py-16">
                        <div class="relative inline-block">
                            <div class="text-8xl text-gray-300 dark:text-gray-600 mb-4 animate-pulse-slow">
                                <i class="far fa-heart"></i>
                            </div>
                            <div class="absolute -top-2 -right-2 w-12 h-12 bg-red-500 rounded-full opacity-20 animate-ping"></div>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø±ØºØ©</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-8 max-w-md mx-auto">
                            Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø¯ÙˆØ±Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¨Ø¹Ø¯. Ø§Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ£Ø¶Ù Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ø¯ÙŠÙƒ!
                        </p>
                        <a href="{% url 'courses:course_list' %}" 
                        class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl hover:from-primary-700 hover:to-primary-800 transition transform hover:scale-105 shadow-xl group">
                            <i class="fas fa-search ml-2 group-hover:rotate-12 transition"></i>
                            Ø§Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>



            <!-- ==================== ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£Ù†Ø´Ø·Ø© ==================== -->
            <div id="activities-tab" class="tab-content hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        <i class="fas fa-history text-primary-600"></i>
                        Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©
                    </h2>
                    
                    {% if recent_activities %}
                    <div class="space-y-4">
                        {% for activity in recent_activities %}
                        <div class="flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl hover:shadow-md transition group">
                            <div class="relative">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center
                                    {% if activity.status == 'completed' %}bg-green-100 dark:bg-green-900
                                    {% elif activity.status == 'enrolled' %}bg-primary-100 dark:bg-primary-900
                                    {% else %}bg-yellow-100 dark:bg-yellow-900{% endif %}">
                                    <i class="fas 
                                        {% if activity.status == 'completed' %}fa-check-circle text-green-600 dark:text-green-400
                                        {% elif activity.status == 'enrolled' %}fa-play-circle text-primary-600 dark:text-primary-400
                                        {% else %}fa-clock text-yellow-600 dark:text-yellow-400{% endif %} text-xl">
                                    </i>
                                </div>
                                {% if forloop.first %}
                                <span class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full animate-ping"></span>
                                {% endif %}
                            </div>
                            
                            <div class="flex-1">
                                <div class="flex justify-between items-start mb-1">
                                    <div>
                                        <h4 class="font-semibold">{{ activity.course.title }}</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">
                                            {% if activity.status == 'completed' %}
                                            ğŸ‰ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø¯ÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­
                                            {% elif activity.status == 'enrolled' %}
                                            ğŸ“š ØªÙ‚Ø¯Ù…Ùƒ: {{ activity.progress }}%
                                            {% else %}
                                            â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                                            {% endif %}
                                        </p>
                                    </div>
                                    <span class="text-xs text-gray-500 bg-white dark:bg-gray-800 px-2 py-1 rounded-full">
                                        {{ activity.last_accessed|timesince }}
                                    </span>
                                </div>
                                
                                {% if activity.status == 'enrolled' and activity.progress < 100 %}
                                <div class="mt-2 flex items-center gap-2">
                                    <div class="flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                        <div class="bg-primary-600 rounded-full h-2 progress-bar" 
                                             style="width: {{ activity.progress }}%"></div>
                                    </div>
                                    <span class="text-xs font-medium text-primary-600">{{ activity.progress }}%</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-16">
                        <div class="text-7xl text-gray-300 dark:text-gray-600 mb-4 animate-bounce-slow">
                            <i class="far fa-clock"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ø¨Ø¹Ø¯</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù†</p>
                        <a href="{% url 'courses:course_list' %}" 
                           class="inline-flex items-center px-6 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition transform hover:scale-105 shadow-lg">
                            <i class="fas fa-play ml-2"></i>
                            Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù…
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© -->
<div id="avatarModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full mx-4 p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
            <button onclick="closeAvatarModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="space-y-4">
            <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                <p class="text-gray-600 dark:text-gray-400">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ</p>
                <button class="mt-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition">
                    Ø§Ø®ØªØ± ØµÙˆØ±Ø©
                </button>
            </div>
            <p class="text-xs text-gray-500 text-center">Ø£Ù‚ØµÙ‰ Ø­Ø¬Ù…: 5MB. Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©: JPG, PNG, GIF</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ====================
    function showTab(tabName) {
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
        });
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù…Ø¹ ØªØ£Ø«ÙŠØ±
        const selectedTab = document.getElementById(`${tabName}-tab`);
        selectedTab.classList.remove('hidden');
        selectedTab.classList.add('animate__animated', 'animate__fadeIn');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        document.querySelectorAll('.tab-link').forEach(link => {
            link.classList.remove('active', 'bg-gray-100', 'dark:bg-gray-700', 'text-primary-600', 'dark:text-primary-400');
        });
        
        const activeLink = document.querySelector(`[data-tab="${tabName}"]`);
        if (activeLink) {
            activeLink.classList.add('active', 'bg-gray-100', 'dark:bg-gray-700', 'text-primary-600', 'dark:text-primary-400');
        }
        
        // ØªØ­Ø¯ÙŠØ« URL hash
        window.location.hash = tabName;
    }

    // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ====================
    function removeFromFavorites(courseId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ')) {
            return;
        }
        
        fetch('/ajax/toggle-favorite/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'X-Requested-With': 'XMLHttpRequest',
            },
            body: new URLSearchParams({
                'course_id': courseId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success' && !data.is_favorite) {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø¨ØªØ£Ø«ÙŠØ± Ø­Ø±ÙƒÙŠ
                const card = event.target.closest('.group');
                card.style.transition = 'all 0.3s ease';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9) translateY(-20px)';
                
                setTimeout(() => {
                    card.remove();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
                    updateFavoritesCount();
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø£ØµØ¨Ø­Øª ÙØ§Ø±ØºØ©
                    const remainingCards = document.querySelectorAll('#favorites-tab .group').length;
                    if (remainingCards === 0) {
                        location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ©
                    }
                }, 300);
                
                showNotification('âœ… ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'success');
            }
        })
        .catch(error => {
            showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
    function updateFavoritesCount() {
        const sidebarBadge = document.querySelector('[data-tab="favorites"] .bg-red-500');
        const headerBadge = document.querySelector('#favorites-tab .bg-red-100');
        
        if (sidebarBadge) {
            const currentCount = parseInt(sidebarBadge.textContent) - 1;
            if (currentCount > 0) {
                sidebarBadge.textContent = currentCount;
            } else {
                sidebarBadge.remove();
            }
        }
        
        if (headerBadge) {
            const currentCount = parseInt(headerBadge.textContent) - 1;
            if (currentCount > 0) {
                headerBadge.innerHTML = `<i class="fas fa-heart ml-2"></i>${currentCount} Ø¯ÙˆØ±Ø©`;
            } else {
                headerBadge.remove();
            }
        }
    }


    // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© ====================
    document.getElementById('avatar-upload')?.addEventListener('change', function(e) {
        if (this.files && this.files[0]) {
            const file = this.files[0];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª', 'error');
                this.value = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚Ù„
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
            if (!file.type.match('image.*')) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ÙÙ‚Ø· (jpg, png, gif)', 'error');
                this.value = '';
                return;
            }
            
            const formData = new FormData();
            formData.append('avatar', file);
            formData.append('csrfmiddlewaretoken', csrftoken);
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...');
            
            fetch('/profile/update-avatar/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => { throw err; });
                }
                return response.json();
            })
            .then(data => {
                hideLoading();
                if (data.status === 'success') {
                    showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
                    const avatarImg = document.querySelector('.group img, .group div[class*="bg-gradient"]');
                    if (avatarImg && avatarImg.tagName === 'IMG') {
                        avatarImg.src = data.avatar_url + '?t=' + new Date().getTime(); // Ø¥Ø¶Ø§ÙØ© timestamp Ù„Ù…Ù†Ø¹ cache
                    } else {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                        setTimeout(() => location.reload(), 1500);
                    }
                } else {
                    showNotification('âŒ ' + data.message, 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification(error.message || 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
            });
        }
    });

    // ØªØ­Ø³ÙŠÙ† Ø¯Ø§Ù„Ø© showLoading
    function showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
        const spinner = document.getElementById('loading-spinner');
        const messageEl = spinner.querySelector('p');
        if (messageEl) {
            messageEl.textContent = message;
        }
        spinner.classList.remove('hidden');
        spinner.classList.add('flex');
    }

    // ØªØ­Ø³ÙŠÙ† Ø¯Ø§Ù„Ø© hideLoading
    function hideLoading() {
        const spinner = document.getElementById('loading-spinner');
        spinner.classList.add('hidden');
        spinner.classList.remove('flex');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        const messageEl = spinner.querySelector('p');
        if (messageEl) {
            messageEl.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
        }
    }


    // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ====================
    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl shadow-2xl z-50 animate__animated animate__fadeInDown ${
            type === 'success' ? 'bg-green-500' : 
            type === 'error' ? 'bg-red-500' : 
            'bg-blue-500'
        } text-white flex items-center gap-3`;
        
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('animate__fadeOutUp');
            setTimeout(() => notification.remove(), 500);
        }, 3000);
    }
    // ==================== Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ====================
    function showLoading() {
        document.getElementById('loading-spinner').classList.remove('hidden');
        document.getElementById('loading-spinner').classList.add('flex');
    }

    function hideLoading() {
        document.getElementById('loading-spinner').classList.add('hidden');
        document.getElementById('loading-spinner').classList.remove('flex');
    }

    // ==================== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† URL hash Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ====================
    window.addEventListener('load', function() {
        const hash = window.location.hash.substring(1);
        if (hash && ['profile', 'stats', 'favorites', 'activities'].includes(hash)) {
            showTab(hash);
        }
        
        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        animateNumbers();
    });

    // ==================== ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ====================
    function animateNumbers() {
        document.querySelectorAll('.counter').forEach(counter => {
            const target = parseInt(counter.innerText);
            let current = 0;
            const increment = target / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    counter.innerText = target;
                    clearInterval(timer);
                } else {
                    counter.innerText = Math.round(current);
                }
            }, 20);
        });
    }

    // ==================== Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ modal ====================
    function closeAvatarModal() {
        document.getElementById('avatarModal').classList.add('hidden');
        document.getElementById('avatarModal').classList.remove('flex');
    }

    // ==================== Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ====================
    document.addEventListener('keydown', function(e) {
        // Ctrl+1,2,3,4 Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        if (e.ctrlKey && !e.shiftKey) {
            const tabs = ['profile', 'stats', 'favorites', 'activities'];
            const index = parseInt(e.key) - 1;
            if (index >= 0 && index < tabs.length) {
                e.preventDefault();
                showTab(tabs[index]);
            }
        }
        
        // Esc Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ modal
        if (e.key === 'Escape') {
            closeAvatarModal();
        }
    });
</script>

<style>
    /* Ø£Ù†Ù…ÙŠØ´Ù† Ø¥Ø¶Ø§ÙÙŠØ© */
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .tab-content {
        animation: slideIn 0.3s ease-out;
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>
{% endblock %}